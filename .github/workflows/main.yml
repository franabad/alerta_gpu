name: Scrape GPU
on:
  schedule:
    - cron: '0 9 * * *' # Ejecutar todos los d√≠as a las 9:00 AM
  workflow_dispatch:

jobs:
  scrape:
    runs-on: ubuntu-latest
    container:
      image: 'node:18-buster'
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Install Dependencies
        run: |
          apt-get update
          apt-get install -y libnss3-dev libatk-bridge2.0-0 libgconf-2-4 libatk1.0-0 libatspi2.0-0 \
            libgbm-dev libpango-1.0-0 libx11-xcb1 libxcb-dri3-0 libxshmfence-dev libegl1-mesa-dev \
            libasound2 xauth xvfb libcups2-dev libxcomposite-dev libxrandr-dev libxkbcommon-dev
          npm install
      - name: Run Script
        run: xvfb-run --auto-servernum --server-args='-screen 0 640x480x24' node index.js
      - name: Push changes
        if: always()
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.email "fam1096@hotmail.com"
          git config --global user.name "franabad"
          git config --global --add safe.directory "/__w/alerta_gpu/alerta_gpu"
          git add screenshot.png output.json
          git commit -m "Add screenshot.png via GitHub Action"
          git push origin HEAD:main
